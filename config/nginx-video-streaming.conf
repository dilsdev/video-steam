# Nginx Configuration for Video Streaming
# This file should be included in your Nginx server block

# ============================================
# IMPORTANT: Update the paths below to match your server setup
# ============================================

# Internal location for full videos (accessible only via X-Accel-Redirect)
location /internal-videos/ {
    internal;
    
    # Update this path to match your storage location
    # For Laravel, this is typically: /path/to/your/project/storage/app/private/private/videos/
    alias /var/www/video-stream/storage/app/private/private/videos/;
    
    # Enable sendfile for better performance
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    
    # Disable access log for performance
    access_log off;
    
    # MIME types for video files
    types {
        video/mp4 mp4;
        video/webm webm;
        video/ogg ogv;
        video/x-msvideo avi;
        video/x-matroska mkv;
        video/quicktime mov;
    }
    default_type video/mp4;
    
    # Enable byte-range requests for seeking
    add_header Accept-Ranges bytes;
    
    # Security headers
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options SAMEORIGIN;
    
    # Cache headers (optional - videos are large so browser caching helps)
    add_header Cache-Control "private, max-age=2592000";
}

# Internal location for preview videos
location /internal-previews/ {
    internal;
    
    # Update this path to match your storage location
    alias /var/www/video-stream/storage/app/private/previews/;
    
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    
    access_log off;
    
    types {
        video/mp4 mp4;
    }
    default_type video/mp4;
    
    add_header Accept-Ranges bytes;
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options SAMEORIGIN;
    add_header Cache-Control "public, max-age=86400"; # 1 day cache for previews
}

# ============================================
# Example full Nginx server block
# ============================================
# 
# server {
#     listen 80;
#     server_name yourdomain.com;
#     root /var/www/video-stream/public;
#     
#     index index.php;
#     
#     location / {
#         try_files $uri $uri/ /index.php?$query_string;
#     }
#     
#     location ~ \.php$ {
#         fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
#         fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
#         include fastcgi_params;
#     }
#     
#     # Include the video streaming configuration
#     include /var/www/video-stream/config/nginx-video-streaming.conf;
# }
