# Nginx Video Streaming Configuration for dev.vistia.site
# Place this file at: /www/server/panel/vhost/nginx/extension/dev.vistia.site/video-streaming.conf

# Internal location for full videos (X-Accel-Redirect)
location /internal-videos/ {
    internal;
    
    # Path ke folder video private
    alias /www/wwwroot/dev.vistia.site/storage/app/private/private/videos/;
    
    # Performance optimizations
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    aio on;
    directio 512;
    
    # Disable logging for performance
    access_log off;
    
    # MIME types for video
    types {
        video/mp4 mp4;
        video/webm webm;
        video/ogg ogv;
        video/x-msvideo avi;
        video/x-matroska mkv;
        video/quicktime mov;
    }
    default_type video/mp4;
    
    # Enable byte-range for seeking
    add_header Accept-Ranges bytes;
    
    # Security headers
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options SAMEORIGIN;
    
    # Cache control
    add_header Cache-Control "private, max-age=2592000";
}

# Internal location for preview videos (optional)
location /internal-previews/ {
    internal;
    alias /www/wwwroot/dev.vistia.site/storage/app/private/previews/;
    
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    
    access_log off;
    
    types {
        video/mp4 mp4;
    }
    default_type video/mp4;
    
    add_header Accept-Ranges bytes;
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options SAMEORIGIN;
    add_header Cache-Control "public, max-age=86400";
}

# Laravel routing - IMPORTANT: Add this if not already in rewrite config
location / {
    try_files $uri $uri/ /index.php?$query_string;
}
